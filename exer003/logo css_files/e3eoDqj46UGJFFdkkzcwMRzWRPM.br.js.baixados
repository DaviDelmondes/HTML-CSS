var CollChannel;(function(n){var t=function(){function n(n,t,i,r){this.isRelay=!1;this.asRelay=!1;this.BCActionMessage="Collections.BroadcastedMessage";this.MCActionMessage="Collections.MCMessage";this.BCName="Collections.BroadcastChannel";var u=this;u.onMessagePortMessage=u.onMessagePortMessage.bind(u);u.onBroadcastMessage=u.onBroadcastMessage.bind(u);u.onMessageCB=n;u.childRelayIframeUrl=t;u.isInitilized=!1;u.childIframe=null;u.asRelay=r;u.elementIDToAddIframe=i}return n.prototype.initialize=function(){if("BroadcastChannel"in window){var n=this;n.isInitilized&&n.close();n.bc=new BroadcastChannel(n.BCName);n.bc.onmessage=n.onBroadcastMessage;n.childRelayIframeUrl&&(n.injectRelayingIframe(n.childRelayIframeUrl,n.elementIDToAddIframe),window.onmessage=function(t){(t===null||t===void 0?void 0:t.data)&&t.data==n.MCActionMessage&&(n.msgPortToChild=t.ports[0],n.msgPortToChild.onmessage=n.onMessagePortMessage)});n.asRelay&&n.createMessageChannel();n.isInitilized=!0}},n.prototype.broadcastMessage=function(n){var t,i,r=this;r.isInitilized&&((t=r.bc)===null||t===void 0?void 0:t.postMessage(n),(i=r.msgPortToChild)===null||i===void 0?void 0:i.postMessage(n))},n.prototype.close=function(){var t,i,r,u,f,n=this;(t=n.bc)===null||t===void 0?void 0:t.close();(i=n.msgPortToParent)===null||i===void 0?void 0:i.close();(r=n.msgPortToChild)===null||r===void 0?void 0:r.close();(f=(u=n.childIframe)===null||u===void 0?void 0:u.parent)===null||f===void 0?void 0:f.removeChild(n.childIframe);n.bc=null;n.msgPortToChild=null;n.msgPortToParent=null;n.childIframe=null;n.isInitilized=!1},n.prototype.createMessageChannel=function(){var t,n=this,i=new MessageChannel;n.msgPortToParent=i.port1;n.msgPortToParent.onmessage=n.onMessagePortMessage;(t=window.parent)===null||t===void 0?void 0:t.postMessage(n.MCActionMessage,"*",[i.port2]);n.isRelay=!0},n.prototype.injectRelayingIframe=function(n,t){var r,u=document,i=sj_ce("iframe");i.setAttribute("src",n);i.style.width="0";i.style.height="0";i.style.display="none";i.setAttribute("tabindex","-1");t&&u.getElementById(t)?u.getElementById(t).appendChild(i):(r=u.body)===null||r===void 0?void 0:r.appendChild(i)},n.prototype.onMessagePortMessage=function(n){var i,t=this;if(t.isRelay){(i=t.bc)===null||i===void 0?void 0:i.postMessage(n.data);return}if(t.onMessageCB)t.onMessageCB(n.data)},n.prototype.onBroadcastMessage=function(n){var i,t=this;if(t.isRelay){(i=t.msgPortToParent)===null||i===void 0?void 0:i.postMessage(n.data);return}if(t.onMessageCB)t.onMessageCB(n.data)},n}();n.CollectionsBroadcastChannel=t,function(){typeof sj_evt!="undefined"&&sj_evt.fire("CollectionsBCLoaded")}()})(CollChannel||(CollChannel={}))